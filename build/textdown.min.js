/*! textdown 2013-10-24 */
var Textdown=function(a){this.textile=a,this.text=this.textile,this.preBlocks=[]};Textdown.prototype.convertHeaders=function(){var a=/^(h[1-6])\.\s?(.*)$/gm;this.text=this.text.replace(a,"<$1>$2</$1>")},Textdown.prototype.convertBlockQuotes=function(){var a=/^bq\.\s?(.*)$/gm;this.text=this.text.replace(a,"<blockquote><p>$1</p></blockquote>")},Textdown.prototype.convertLists=function(){for(var a="",b=this.text.split(/\n/gm),c=!1,d=0;d<b.length;d++){var e=b[d],f="#"===e.charAt(0),g="*"===e.charAt(0);f||g?(listType="ul",f&&(listType="ol"),c||(c=!0,a+="<"+listType+">"),a+="<li>"+e.substr(2)+"</li>",d===b.length-1&&(c=!1,a+="</"+listType+">")):(0===e.length&&c&&(c=!1,a+="</"+listType+">"),a+="\n"+e+"\n")}this.text=a},Textdown.prototype.parsePreBlocks=function(){var a=/(<pre[^>]*>[\s\S]+?<\/pre>)/gm,b=this.text.match(a)||[];b.length&&(this.preBlocks=b,this.text=this.text.replace(a,"^^^^^^"))},Textdown.prototype.revertPreBlocks=function(){if(this.preBlocks.length)for(var a=0;a<this.preBlocks.length;a++){var b=this.preBlocks[a];this.text=this.text.replace("^^^^^^",b)}},Textdown.prototype.convertParagraphs=function(){for(var a=this.text.trim().split(/\n{2,}/gm),b=0;b<a.length;b++){var c=a[b];"<"!==c.charAt(0)&&"^^^^^^"!==c&&(a[b]="<p>"+a[b]+"</p>")}this.text=a.join("")},Textdown.prototype.convertQuotes=function(){var a="&#8220;",b="&#8221;",c=/\s\"([^\"]+)\"/gm;this.text=this.text.replace(c,function(c){var d=c;return d=d.replace(/\"/,a),d=d.replace(/\"/,b)})},Textdown.prototype.convertDoubleHyphens=function(){this.text=this.text.replace(/\s*--\s*/gm,"&#8212;")},Textdown.prototype.convertSingleHyphens=function(){this.text=this.text.replace(/\s*-\s*/gm,"&#8211;")},Textdown.prototype.convertTripleDots=function(){this.text=this.text.replace(/\.{3}/gm,"&#8230;")},Textdown.prototype.convertDimensions=function(){this.text=this.text.replace(/\sx\s/gm,"&#215;")},Textdown.prototype.convertSymbols=function(){function a(a){var b={"(TM)":"&#8482;","(R)":"&#174;","(C)":"&#169;"};return b[a]}var b=/\((TM|R|C)\)/gm;this.text=this.text.replace(b,a)},Textdown.prototype.convertLinks=function(){var a=/\"([^\"]+)\"\:(\S+)\b/gm;this.text=this.text.replace(a,'<a href="$2">$1</a>')},Textdown.prototype.convertImages=function(){var a=/!(([^!\s\(]+)(\((\w+)\))?)!/gm;this.text=this.text.replace(a,function(a,b,c,d,e){return e=e||"",'<img src="'+c+'" alt="'+e+'" />'})},Textdown.prototype.convertEmphasis=function(){var a=/_([^_]+)_/gm;this.text=this.text.replace(a,"<em>$1</em>")},Textdown.prototype.convertBold=function(){var a=/(?!^)\*([^\*]+)\*/gm;this.text=this.text.replace(a,"<strong>$1</strong>")},Textdown.prototype.convertCitations=function(){var a=/\?{2}([^\?]+)\?{2}/gm;this.text=this.text.replace(a,"<cite>$1</cite>")},Textdown.prototype.toHtml=function(){return this.parsePreBlocks(),this.convertHeaders(),this.convertLinks(),this.convertImages(),this.convertQuotes(),this.convertDoubleHyphens(),this.convertSingleHyphens(),this.convertTripleDots(),this.convertDimensions(),this.convertSymbols(),this.convertEmphasis(),this.convertBold(),this.convertCitations(),this.convertBlockQuotes(),this.convertLists(),this.convertParagraphs(),this.revertPreBlocks(),this.text};